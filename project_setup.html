<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Setup Proyek</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">

  <div class="max-w-3xl mx-auto bg-white rounded shadow p-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-2xl font-semibold text-gray-700">âš™ï¸ Setup Proyek</h2>
      <a href="dashboard.html" class="text-sm text-indigo-600 hover:underline">â¬… Kembali ke Dashboard</a>
    </div>

    <button type="button" onclick="exportSetupPDF()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 mt-4">
        ğŸ“„ Export Setup ke PDF
      </button>      

    <form id="setupForm" onsubmit="saveSetup(event)">
      <div class="mb-4">
        <label class="block text-gray-700 mb-1">ğŸ“ Nama Proyek</label>
        <input type="text" id="projectName" class="w-full px-3 py-2 border rounded" readonly />
      </div>

      <div class="mb-4">
        <label class="block text-gray-700 mb-1">ğŸ“ Rangkuman Awal Proyek</label>
        <textarea id="summary" class="w-full px-3 py-2 border rounded" placeholder="Deskripsi singkat proyek..."></textarea>
      </div>

      <div class="mb-4">
        <label class="block text-gray-700 mb-1">ğŸ“„ Detail Setup Proyek</label>
        <textarea id="details" class="w-full px-3 py-2 border rounded" placeholder="Langkah setup lingkungan, dependensi, dll..."></textarea>
      </div>

      <div class="mb-4">
        <label class="block text-gray-700 mb-1">ğŸ”— Link Tambahan (opsional)</label>
        <input type="url" id="link" class="w-full px-3 py-2 border rounded" placeholder="https://contoh.com" />
      </div>

      <div class="mb-4">
        <label class="block text-gray-700 mb-1">ğŸ“Œ Link Penting (opsional)</label>
        <input type="url" id="importantLink" class="w-full px-3 py-2 border rounded" placeholder="https://repo.com/docs" />
      </div>

      <div class="mb-4">
        <label class="block text-gray-700 mb-1">ğŸ–¼ï¸ Upload Gambar Setup</label>
        <input type="file" id="imageUpload" accept="image/*" class="w-full mb-2" onchange="previewImage()" />
        <img id="previewImage" src="" class="max-h-48 rounded border hidden" />
      </div>

      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        ğŸ’¾ Simpan Setup
      </button>

    </form>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const project = new URLSearchParams(window.location.search).get("project") || "default";
      document.getElementById("projectName").value = project;
  
      // Load existing setup
      const saved = JSON.parse(localStorage.getItem(`projectSetup_${project}`)) || {};
      if (saved.summary) document.getElementById("summary").value = saved.summary;
      if (saved.details) document.getElementById("details").value = saved.details;
      if (saved.link) document.getElementById("link").value = saved.link;
      if (saved.importantLink) document.getElementById("importantLink").value = saved.importantLink;
      if (saved.image) {
        const img = document.getElementById("previewImage");
        img.src = saved.image;
        img.classList.remove("hidden");
      }
  
      // Fungsi preview image
      document.getElementById("imageUpload").addEventListener("change", function () {
        const file = this.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const img = document.getElementById("previewImage");
            img.src = e.target.result;
            img.classList.remove("hidden");
          };
          reader.readAsDataURL(file);
        }
      });
  
      // Fungsi simpan
      document.getElementById("setupForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const data = {
          summary: document.getElementById("summary").value,
          details: document.getElementById("details").value,
          link: document.getElementById("link").value,
          importantLink: document.getElementById("importantLink").value,
          image: document.getElementById("previewImage").src || null
        };
        localStorage.setItem(`projectSetup_${project}`, JSON.stringify(data));
        alert("âœ… Setup proyek berhasil disimpan!");
      });
    });

    function exportSetupPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const project = document.getElementById("projectName").value;
    const summary = document.getElementById("summary").value;
    const details = document.getElementById("details").value;
    const link = document.getElementById("link").value;
    const importantLink = document.getElementById("importantLink").value;

    doc.setFontSize(14);
    doc.text(`ğŸ“ Setup Proyek: ${project}`, 10, 15);

    doc.setFontSize(11);
    let y = 25;
    doc.text("ğŸ“ Rangkuman:", 10, y); y += 7;
    doc.setFont("normal"); doc.text(summary || '-', 12, y); y += 10;

    doc.setFont("bold"); doc.text("ğŸ“„ Detail Setup:", 10, y); y += 7;
    doc.setFont("normal"); doc.text(details || '-', 12, y); y += 10;

    if (link) {
        doc.setFont("bold"); doc.text("ğŸ”— Link Tambahan:", 10, y); y += 7;
        doc.setFont("normal"); doc.text(link, 12, y); y += 7;
    }

    if (importantLink) {
        doc.setFont("bold"); doc.text("ğŸ“Œ Link Penting:", 10, y); y += 7;
        doc.setFont("normal"); doc.text(importantLink, 12, y); y += 7;
    }

    doc.save(`setup_project_${project}.pdf`);
    }

  </script>
  
</body>
</html>
